stages:
    - sync-fork
    - build-author-dev
    - build-publishes-dev
    - build-author-test
    - build-publishes-test
variables:
    GITLAB_GROUP_PROD: "silversea-prod"
    GIT_PROD_USER: "ci-user"

### DEV Build
mvn_build_dev_author:
    stage: build-author-dev
    environment:
        name: Dev
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.6.213:4502
    only:
        - develop

mvn_build_dev_publish1:
    stage: build-publishes-dev
    environment:
        name: Dev
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.13.214:4503
    only:
        - develop

mvn_build_dev_publish2:
    stage: build-publishes-dev
    environment:
        name: Dev
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.21.95:4503
    only:
        - develop

### TEST Build
mvn_build_test_author:
    stage: build-author-test
    environment:
        name: Test
    when: manual
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.0.113:4502
    only:
        - develop

mvn_build_test_publish1:
    stage: build-publishes-test
    environment:
        name: Test
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.13.79:4503
    only:
        - develop

mvn_build_test_publish2:
    stage: build-publishes-test
    environment:
        name: Test
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.4.121:4503
    only:
        - develop

### RC Build
mvn_build_rc_author:
    stage: build-author
    environment:
        name: RC
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.2.240:4502
    only:
        - /^release-.*$/

mvn_build_rc_publish1:
    stage: build-publishes
    environment:
        name: RC
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.0.114:4503
    only:
        - /^release-.*$/

mvn_build_rc_publish2:
    stage: build-publishes
    environment:
        name: RC
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.url=http://172.31.22.151:4503
    only:
        - /^release-.*$/

### Release Build
mvn_build_release_author:
    stage: build-author
    environment:
        name: Stage
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_STAGE_PASSWORD -Dcq.user=ci-user  -Dcq.url=http://34.194.113.231:4502
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$/

mvn_build_release_publish1:
    stage: build-publishes
    environment:
        name: Stage
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_STAGE_PASSWORD -Dcq.user=ci-user -Dcq.url=http://34.196.202.218:4503
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$/

mvn_build_release_publish2:
    stage: build-publishes
    environment:
        name: Stage
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_PROD_PASSWORD -Dcq.user=ci-user -Dcq.url=http://34.192.200.203:4503
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$/

### Production Build
mvn_build_prod_author:
    stage: build-author
    environment:
        name: Production
    when: manual
    tags:
        - maven-prod
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_PROD_PASSWORD -Dcq.user=ci-user  -Dcq.url=http://34.196.205.150:4502
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-GA$/

mvn_build_prod_publish1:
    stage: build-publishes
    environment:
        name: Production
    when: manual
    tags:
        - maven-prod
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_PROD_PASSWORD -Dcq.user=ci-user -Dcq.url=http://34.192.201.181:4503
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-GA$/

mvn_build_prod_publish2:
    stage: build-publishes
    environment:
        name: Production
    when: manual
    tags:
        - maven-prod
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_STAGE_PASSWORD -Dcq.user=ci-user -Dcq.url=http://34.192.216.200:4503
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-GA$/