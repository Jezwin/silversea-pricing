stages:
    - analysis
    - build-author-stage
    - build-publishes-stage
    - build-author-prod
    - build-publishes-prod

### TEST Build
analysis_sonar:
    stage: analysis
    when: manual
    tags:
        - maven
    script:
        - mvn package sonar:sonar -Dsonar.host.url=http://13.56.217.186/ -Dsonar.login=admin -Dsonar.password=4wZ5zjvF0Ve6
    only:
        - develop

### Migration Build
mvn_build_mig_author:
    stage: build-author-stage
    environment:
        name: Migration
    when: manual
    allow_failure: false
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_STAGE_PASSWORD -Dcq.user=ci-user -Dcq.url=http://18.204.183.84:4502
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$/

mvn_build_mig_publish1:
    stage: build-publishes-stage
    environment:
        name: Migration
    when: manual
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_STAGE_PASSWORD -Dcq.user=ci-user -Dcq.url=http://18.234.4.77:4503
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$/

mvn_build_mig_publish2:
    stage: build-publishes-stage
    environment:
        name: Migration
    when: manual
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_STAGE_PASSWORD -Dcq.user=ci-user -Dcq.url=http://35.173.158.72:4503
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$/
        
### Migration PROD Build
mvn_build_mig_author_prod:
    stage: build-author-prod
    environment:
        name: Migration_prod
    when: manual
    allow_failure: false
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_PROD_PASSWORD -Dcq.user=ci-user -Dcq.url=http://18.211.58.161:4502
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-GA$/

mvn_build_mig_publish1_prod:
    stage: build-publishes-prod
    environment:
        name: Migration_prod
    when: manual
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_PROD_PASSWORD -Dcq.user=ci-user -Dcq.url=http://35.168.37.187:4503
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-GA$/

mvn_build_mig_publish2_prod:
    stage: build-publishes-prod
    environment:
        name: Migration_prod
    when: manual
    tags:
        - maven
    script:
        - mvn clean install -Pauto-install-package -Dcq.password=$AUTHOR_PROD_PASSWORD -Dcq.user=ci-user -Dcq.url=http://18.214.75.8:4503
    only:
        - /^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-GA$/